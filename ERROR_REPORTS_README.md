# üìä –°–∏—Å—Ç–µ–º–∞ Error –û—Ç—á–µ—Ç–æ–≤

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ error –æ—Ç—á–µ—Ç–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –ª–æ–≥–æ–≤

–í—Å–µ –ª–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `logs/`:

```
logs/
‚îú‚îÄ‚îÄ app.log          # –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ä–æ—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–∑–º–µ—Ä—É)
‚îú‚îÄ‚îÄ errors.log       # –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –æ–± –æ—à–∏–±–∫–∞—Ö (—Ä–æ—Ç–∞—Ü–∏—è –ø–æ –¥–Ω—è–º)
‚îî‚îÄ‚îÄ errors.json      # –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ (—Ä–æ—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–∑–º–µ—Ä—É)
```

## üìã –¢–∏–ø—ã –ª–æ–≥–∏—Ä—É–µ–º—ã—Ö –æ—à–∏–±–æ–∫

### 1. **–û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π**
- –û—à–∏–±–∫–∏ –ø—Ä–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π AmoCRM ‚Üí Edna
- –û—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ Edna API
- –û—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å—Ç–∞—Ç—É—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ AmoCRM

### 2. **API –æ—à–∏–±–∫–∏**
- HTTP –æ—à–∏–±–∫–∏ –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å Edna API
- –û—à–∏–±–∫–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å AmoCRM API
- –¢–∞–π–º–∞—É—Ç—ã –∏ —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏

### 3. **–°–∏—Å—Ç–µ–º–Ω—ã–µ –æ—à–∏–±–∫–∏**
- –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –û—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üîç –ü—Ä–æ—Å–º–æ—Ç—Ä error –æ—Ç—á–µ—Ç–æ–≤

### –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
```bash
# –°–≤–æ–¥–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
python src/scripts/view_error_reports.py summary

# –°–≤–æ–¥–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 —á–∞—Å–æ–≤
python src/scripts/view_error_reports.py summary 6
```

### –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
```bash
# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
python src/scripts/view_error_reports.py detail 0

# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Ç–æ—Ä–æ–π –æ—à–∏–±–∫–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 12 —á–∞—Å–æ–≤
python src/scripts/view_error_reports.py detail 1 12
```

### –°–ø—Ä–∞–≤–∫–∞
```bash
python src/scripts/view_error_reports.py help
```

## üìÑ –§–æ—Ä–º–∞—Ç error –æ—Ç—á–µ—Ç–æ–≤

### –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (errors.log)
```
2024-08-28 15:30:45 - ERROR REPORT
=====================================
Logger: use_cases.route_messages
Level: ERROR
Message: –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ AmoCRM
Module: use_cases.route_messages
Function: execute
Line: 184
Process: 12345
Thread: 67890
Exception Type: <class 'httpx.HTTPStatusError'>
```

### JSON —Ñ–æ—Ä–º–∞—Ç (errors.json)
```json
{
  "timestamp": "2024-08-28T15:30:45.123456",
  "level": "ERROR",
  "logger": "use_cases.route_messages",
  "message": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ AmoCRM",
  "module": "use_cases.route_messages",
  "function": "execute",
  "line": 184,
  "exception": "httpx.HTTPStatusError: Client error '404 Not Found'..."
}
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤

### errors.log
- **–†–æ—Ç–∞—Ü–∏—è**: –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ –ø–æ–ª–Ω–æ—á—å
- **–•—Ä–∞–Ω–µ–Ω–∏–µ**: 30 –¥–Ω–µ–π
- **–ö–æ–¥–∏—Ä–æ–≤–∫–∞**: UTF-8

### errors.json
- **–†–æ—Ç–∞—Ü–∏—è**: –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 50MB
- **–•—Ä–∞–Ω–µ–Ω–∏–µ**: 10 —Ñ–∞–π–ª–æ–≤
- **–ö–æ–¥–∏—Ä–æ–≤–∫–∞**: UTF-8

### app.log
- **–†–æ—Ç–∞—Ü–∏—è**: –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 10MB
- **–•—Ä–∞–Ω–µ–Ω–∏–µ**: 5 —Ñ–∞–π–ª–æ–≤
- **–ö–æ–¥–∏—Ä–æ–≤–∫–∞**: UTF-8

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –í—Å–µ –æ—à–∏–±–∫–∏ —É—Ä–æ–≤–Ω—è ERROR –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç:
  - –ü–æ–ª–Ω—ã–π traceback
  - –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ (account_id, message_id, conversation_id)
  - HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥—ã –∏ –æ—Ç–≤–µ—Ç—ã API
  - –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥

### –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ JSON –ª–æ–≥–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:
```bash
# –ù–∞–π—Ç–∏ –æ—à–∏–±–∫–∏ –ø–æ —Ç–∏–ø—É
grep '"level":"ERROR"' logs/errors.json | jq '.message'

# –ù–∞–π—Ç–∏ –æ—à–∏–±–∫–∏ API
grep '"service":"Edna"' logs/errors.json | jq '.endpoint'

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ —á–∞—Å–∞–º
grep '"timestamp"' logs/errors.json | cut -d'T' -f2 | cut -d':' -f1 | sort | uniq -c
```

## üö® –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

| –£—Ä–æ–≤–µ–Ω—å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|----------|
| DEBUG   | –î–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è | –¢–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ |
| INFO    | –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–µ | –û—Å–Ω–æ–≤–Ω–æ–π —É—Ä–æ–≤–µ–Ω—å |
| WARNING | –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è | –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è |
| ERROR   | –û—à–∏–±–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | **–õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ error_reports** |
| CRITICAL| –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ | **–õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ error_reports** |

## üîç –ü–æ–∏—Å–∫ –∏ –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫

### –ü–æ–∏—Å–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
```bash
# –û—à–∏–±–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
python src/scripts/view_error_reports.py summary 1

# –û—à–∏–±–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å
python src/scripts/view_error_reports.py summary 24
```

### –ü–æ–∏—Å–∫ –ø–æ —Ç–∏–ø—É –æ—à–∏–±–∫–∏
```bash
# API –æ—à–∏–±–∫–∏
grep "API Error" logs/errors.log

# –û—à–∏–±–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
grep "Delivery status error" logs/errors.log

# –û—à–∏–±–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤
grep "Webhook processing error" logs/errors.log
```

### –ü–æ–∏—Å–∫ –ø–æ —Å–µ—Ä–≤–∏—Å—É
```bash
# –û—à–∏–±–∫–∏ Edna
grep "service.*Edna" logs/errors.json

# –û—à–∏–±–∫–∏ AmoCRM
grep "provider.*amocrm" logs/errors.json
```

## üìà –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É

1. **–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**: –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ —Å–≤–æ–¥–∫—É –æ—à–∏–±–æ–∫ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–µ–Ω–¥–æ–≤**: –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ä–æ—Å—Ç–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—à–∏–±–æ–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞
3. **–ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤**: –ò—â–∏—Ç–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –æ—à–∏–±–∫–∏ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
4. **–†–µ–≥—É–ª—è—Ä–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞**: –°—Ç–∞—Ä—ã–µ –ª–æ–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è, –Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ

## üÜò –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π

### –õ–æ–≥–∏ –Ω–µ –ø–∏—à—É—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `logs/`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ `main.py`

### –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ª–æ–≥–æ–≤
1. –£–≤–µ–ª–∏—á—å—Ç–µ –ø–æ—Ä–æ–≥–∏ —Ä–æ—Ç–∞—Ü–∏–∏ –≤ `main.py`
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
3. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç UTF-8
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–∫–∞–ª–∏
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –∫–æ–¥–∏—Ä–æ–≤–∫—É –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª—ã –ª–æ–≥–æ–≤ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
3. –í–∫–ª—é—á–∏—Ç–µ DEBUG —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
